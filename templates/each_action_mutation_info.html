{% extends "bootstrap/base.html" %}

{% block styles %}
{{ super() }}
<link href="/oncodrug/static/css/main.css" rel="stylesheet"/>
<!-- Animation CSS -->
<link rel="stylesheet" type="text/css" href="/oncodrug/static/css/browse_jquery.dataTables.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

<style>
        body {
        font-family: Arial, sans-serif;
    }

    .custom-hr {
        border-color: #0968C3;
        border-width: 0;
        width: 100%;
        margin: 10px auto;
        background-color: #0968C3;
        height: 3px;
        border: none;
      }
      .custom-navbar .navbar-nav > li > a {
		color: #fff; 
		margin-right: -50px;
	}

    .custom-navbar {
      background: linear-gradient(145deg, #8a33c9, #bc6ed0); 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); 
    border: none; 
}

.caret{
border-top:0px;
}

.bootstrap-table .fixed-table-toolbar .columns label{
    font-size: 15px;
}

.btn-group > .btn:first-child {
    font-size: 15px;
}

.bootstrap-table.bootstrap5 .float-right {
height:35px;

}
.dropup .caret, .navbar-fixed-bottom .dropdown .caret{
  border-bottom:0px;
}

input[type="radio"], input[type="checkbox"] {

    height: 15px;
    width: 15px;
}


.dropdown-menu a {
      font-size: 15px; 
    }

    
    a {
  color: #0968C5; 
      }


    .table thead th {
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 1;
        }


        .custom-table {
            border-width: 1px solid #EEEEEE; 
        }

        .custom-button{
      border: 1.5px solid #064785; 
      background-color: white; 
      border-radius: 15px;  
      color: #064785;
    }

    .custom-button:hover {
            background-color: #064785; 
            color: #fff; 
        }

        .custom-button:active, .custom-button:focus {
            background-color: #064785; 
            color: #fff; 
            outline: none; 
        }

    .navbar .navbar-nav {
      display: inline-block;
      float: none;
      vertical-align: top;
    }

    .navbar .navbar-collapse {
      text-align: center;
    }

    .navbar-nav .nav-link {
        margin-right: 25px;
        margin-left: 25px;
        font-size: 20px;
    }

    #my_navbar.custom-text {
      font-family: Arial, sans-serif;
      font-weight: bold;
    }

    .custom-container {
    max-width: 1700px; 
    margin-left: auto;
    margin-right: auto;
    }

    .custom-statistics {
    max-width: 1700px; 
    margin: 0 auto; 
    
    }
    
      .custom-row {
      margin-top: 40px; 
      margin-bottom: 40px; 
  }

      
      .custom-btn {
      border: 2px solid white;
  }

  
  .custom-btn:hover {
      background-color: white;
  }


    .nav-link {
      font-size: 20px; 
    }

  .bootstrap-table .search input[type="search"] {
      height: 35px; 
      font-size: 14px; 
  }



  .table-wrapper {
      overflow-x: auto;
    }

    footer {
    height: 60px;
    background-color: #6710c7;
    margin-bottom:0;
    position: relative;
    width: 100%;
}

html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        .content {
            flex: 1;
        }

        .footer-content p {
        margin: 10;
        text-align: center; 
        width: 100%; 
    }

</style>
{% endblock %}

{% block scripts%}
{{super()}}

<script>
    $(document).ready(function() {
        var table = $('#nominate').DataTable( {
            scrollY: "30em",
            scrollX: true,
            scrollCollapse: true,
            paging: false,
            fixedColumns: true,

            columnDefs: [
            { type: 'scientific', targets: 4 }, // denote its type for sorting, not for rendering
            ],
        } );
    } );

</script>
<script src="/oncodrug/static/js/browse_bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="/oncodrug/static/css/browse_bootstrap-table.min.css">
<script src="/oncodrug/static/js/browse_tableExport.min.js"></script>
<script src="/oncodrug/static/js/browse_bootstrap-table-locale-all.min.js"></script>


{% endblock %}


{% block navbar %}
<nav class="navbar navbar-inverse custom-navbar">
  <div class="container-fluid justify-content-center">

    <div class="collapse navbar-collapse" >
      <ul class="nav navbar-nav">
          <li class=" nav-link"><a  class="custom-glyph nav-link custom-text" href="{{ url_for('web_index.home') }}" style="font-size: 1.4em;">OncoDrug+</a></li>
        <li class=" nav-link"><a href="{{ url_for('web_index.home') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-home custom-glyph"></span> Home</a></li>
        <li class=" nav-link"><a href="{{ url_for('web_index.browse_levela') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-search custom-glyph"></span> Browse</a></li>
        <li class=" nav-link"><a href="{{ url_for('web_index.biomarker') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-map-marker custom-glyph"></span> SmartQuery</a></li>
        <li class="nav-link"><a href="{{ url_for('web_index.statistics') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-stats custom-glyph"></span> Statistics</a></li>
        <li class="nav-link"><a href="{{ url_for('web_index.download_db') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-download-alt custom-glyph"></span> Download</a></li>
        <li class="nav-link"><a href="{{ url_for('web_index.about_document') }}" class="custom-glyph nav-link custom-text"><span class="glyphicon glyphicon-info-sign custom-glyph"></span> Documentation</a></li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}



{% block content %}

<!--左侧表格栏-->
<div class="content" style="display: flex; flex-wrap: wrap">
    <div class="border-right" style="position:relative;width:300px;padding:15px;">
        <div class="card">
          <img class="card-img-top" src="/oncodrug/static/img/oncodrug_logo_border.png" style="height: 111.7px;width:300px ;" alt="card-img-top">
          
            <div class="card-body">
                <h1 class='card-title' style="text-align: center;">Page introduction</h1>
                <p class='card-text'>This page displays detailed information about biomarkers.<br> </p>            </div>

        </div>
    </div>

<!--右侧表格栏-->
    <div style="position:relative; padding: 10px 20px;padding-top: 10px;width: calc(100% - 300px);">
        <h2>
            Biomarkers        </h2>
          <hr class="custom-hr">

        <div class="col-12" id="showPairDetail">
            <h3 >Detail information for  <span style="background-color:rgb(0, 140, 255);color: rgb(239, 239, 241);border-radius: 10px;display: inline-block;padding: 2px 10px;" >{{ actmut }}</span></h3>

            <table >
          <table id="table" 
              data-toggle="table"
              data-toolbar="#toolbar"
              data-search="true"
              data-pagination="true" 
              data-page-list="[10, 25, 50,all]"
              data-height="500"
              data-sortable="true" 
              data-sort-name="Prioritization_score" 
              data-sort-order="asc"
              class="table table-striped table-bordered custom-table"
              >
            <thead>
                <tr>
                  <th colspan="15">Combination therapy regimens involving this biomarker</th>
                </tr>
                <tr>
                  <th data-visible="true" data-width="200px" data-field="id" data-sortable="true"    data-sort-name="id" data-sort-order="asc" >Drug combination ID</th>
      
                  <th  data-field="Evidence_level" data-width="100px"  data-sortable="true" data-formatter="EviID_tooltipFormatter"  data-sort-name="Evidence_level" data-sort-order="asc">Evidence level</th>
              
                  <th data-field="Prioritization_score" data-width="150px" data-sortable="true" data-formatter="Prioritization_Score_tooltipFormatter" data-sorter="customSorter" data-sort-name="Prioritization_score" data-sort-order="asc">Prioritization score</th>
              
                  <th data-sortable="true" data-width="250px" data-formatter="each_drug_linkFormatter">Targeted drug</th>
              
                  <th data-sortable="true" data-width="250px" data-formatter="each_drug_linkFormatter">Non-targeted drug</th>
                  
                  <th data-sortable="true" data-width="200px" data-formatter="cancer_oncotree_linkFormatter">Cancer type</th>
                  
                <th data-sortable="true"  data-width="250px" data-formatter="actmut_linkFormatter">Biomarkers</th>
  
                <th data-visible="true" data-width="100px"  data-sortable="true" >Response</th>
    
                  <th data-visible="false" data-sortable="true">Adverse effect</th>
    
                  <th data-visible="false" data-sortable="true">Drug dosage</th>
                  <th data-visible="false" data-field="Evidence_level_score" data-sortable="true" data-formatter="Evi_Score_tooltipFormatter"  data-sort-order="asc">Evidence level score</th>
                  <th data-visible="false" data-field="FDA_evidence_score" data-sortable="true" data-formatter="FDA_Score_tooltipFormatter"  data-sort-order="asc">FDA evidence score</th>            
                  <th data-visible="false" data-field="Response_score" data-sortable="true" data-formatter="Response_Score_tooltipFormatter"  data-sort-order="asc">Response score</th>
                  <th data-visible="false" data-field="Action_mutation_score" data-sortable="true" data-formatter="Act_Score_tooltipFormatter" data-sort-order="asc">Biomarkers matching score</th>
                  <th data-visible="false" data-field="Actionable_mutation_precision_score" data-sortable="true" data-formatter="Actionable_Mutation_Precision_Score_tooltipFormatter"  data-sort-order="asc">Biomarkers precision score</th>
    
                </tr>
                </thead>
                <tbody>
                  {% for row in action_mutation_data %}
                  <tr>
                    <td>{{ row.Drug_combination_ID }}</a></td>
                    <td>{{ row.Evidence_level }}</td>
                    <td>{{ row.Prioritization_score }}</td>
                    <td >{{ row.Targeted_drug }}</td>
                    <td>{{ row.Non_targeted_drug }}</td>
                    <td>{{ row.Cancer_type_oncotree_Level2 }}</td>
                    <td>{{ row.Action_mutations }}</td>
                    <td>{{ row.Response }}</td>
                    <td>{{ row.Adverse_effect }}</td>
                    <td>{{ row.Drug_dosage }}</td>
                    <td>{{ row.Evidence_level_score }}</td>
                    <td>{{ row.FDA_evidence_score }}</td>
                    <td>{{ row.Response_score }}</td>
                    <td>{{ row.Action_mutation_level_score }}</td>
                    <td>{{ row.Actionable_mutation_precision_score }}</td>

                </tr>
                  {% endfor %}
              </table>
        </div>
        <!-- Add Bootstrap and Bootstrap Table JavaScript -->
            

        <script src="/oncodrug/static/js/browse_jquery-3.5.1.min.js"></script>
        <script src="/oncodrug/static/js/browse_popper.min.js"></script>
        <script src="/oncodrug/static/js/browse_bootstrap-table.min.js"></script>
        <link rel="stylesheet" href="/oncodrug/static/js/browse_all.min.css">

        <script>

          function customSorter(a, b) {
                return parseInt(b) - parseInt(a);
              }
          // 获取表格元素
          var table = document.getElementById('table');

          // 初始化 Bootstrap Table
          $(table).bootstrapTable({
          showColumns: true ,// 设置显示列按钮为可见
          refresh: true,
          showColumnsToggleAll: true,
          });

          
          var $table = $('#mytable')
              var $remove = $('#remove')
              var selections = []
              function getIdSelections() {
                return $.map($table.bootstrapTable('getSelections'), function (row) {
                  return row.id
                })
              }
            
              function responseHandler(res) {
                $.each(res.rows, function (i, row) {
                  row.state = $.inArray(row.id, selections) !== -1
                })
                return res
              }
            
              function detailFormatter(index, row) {
                var html = []
                $.each(row, function (key, value) {
                  html.push('<p><b>' + key + ':</b> ' + value + '</p>')
                })
                return html.join('')
              }

              function define_evi_IconFormatter(value, row) {
                if (value.includes('Individual case')) {
                  return '<image src="../static/img/people.svg" width="15" height="15">' + ' ' + value;
                } else if (value.includes('Cell Lines')){
                  return '<image src="../static/img/cell_line.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('FDA')){
                  return '<image src="../static/img/FDA.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('Clinical trail')){
                  return '<image src="../static/img/clinical_trial.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('Preclinical expriment')){
                  return '<image src="../static/img/clinical_trial.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('Guidelines')){
                  return '<image src="../static/img/guidelines.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('PDX')){
                  return '<image src="../static/img/PDX.svg" width="15" height="15">' + ' ' + value;
                }else if (value.includes('Bioinformatics')){
                  return '<image src="../static/img/Bioinformatics.svg" width="15" height="15">' + ' ' + value;
                }
              }
              
              function ComID_tooltipFormatter(value,row) {
            if (value.includes('NCI treatment/NCCN guidelines')) {
              return '<span data-toggle="tooltip" title="The data collection for this type of information is sourced from the NATIONAL CANCER INSTITUTE and NCCN Clinical Practice Guidelines in Oncology, documenting clinically applied treatment methods.">' + value + '</span>';
            } else if (value.includes('VICC')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'A harmonized meta-knowledgebase of clinical interpretations of somatic genomic variants in cancer (Pubmed ID: 32246132)\'.">' + value + '</span>';
            }else if (value.includes('TMUSH')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is collected from from Tianjin Medical University Second Hospital provide details about drug therapy during hospital treatment for cancer patients and follow-up data on drug response.">' + value + '</span>';
            }else if (value.includes('ALMANAC')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'The National Cancer Institute ALMANAC: A Comprehensive Screening Resource for the Detection of Anticancer Drug Pairs with Enhanced Therapeutic Activity (Pubmed ID: 28446463)\'.">' + value + '</span>';
            }else if (value.includes('Patricia Jaaks et al. Cell Lines')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'Effective drug combinations in breast, colon and pancreatic cancer cells (Pubmed ID: 35197630)\'.">' + value + '</span>';
            }else if (value.includes('DCDB')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'DCDB 2.0: a major update of the drug combination database (Pubmed ID: 25539768)\'.">' + value + '</span>';
            }else if (value.includes('DrugCombDB')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'DrugCombDB: a comprehensive database of drug combinations toward the discovery of combinatorial therapy (Pubmed ID: 31665429)\'.">' + value + '</span>';
            }else if (value.includes('I-PREDICT Clinical Trial')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'Molecular profiling of cancer patients enables personalized combination therapy: the I-PREDICT study (Pubmed ID: 31011206)\'.">' + value + '</span>';
            }else if (value.includes('Ravi S. Narayan et al. Cell Lines')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'Combining genomic and network characteristics for extended capability in predicting synergistic drugs for cancer (Pubmed ID: 26412466)\'.">' + value + '</span>';
            }else if (value.includes('Hui Gao et al. PDX')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'High-throughput screening using patient-derived tumor xenografts to predict clinical trial drug response (Pubmed ID: 26479923)\'.">' + value + '</span>';
            }else if (value.includes('Jennifer O"Neil et al. Cell Lines')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'An Unbiased Oncology Compound Screen to Identify Novel Combination Strategies (Pubmed ID: 26983881)\'.">' + value + '</span>';
            }else if (value.includes('REFLECT')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'Precision Combination Therapies Based on Recurrent Oncogenic Coalterations (Pubmed ID: 35412613)\'.">' + value + '</span>';
            }else if (value.includes('Nishanth Ulhas Nair et al. Cell Line')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'A landscape of response to drug combinations in non-small cell lung cancer (Pubmed ID: 37380628)\'.">' + value + '</span>';
            }else if (value.includes('ClinicalTrials.gov')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is sourced from ClinicalTrials.gov, which is a website and online database of clinical research studies and information about their results.\'.">' + value + '</span>';
            }else if (value.includes('Azadeh C. Bashi et al. Cell Lines')){
              return '<span data-toggle="tooltip" title="The data collection for this type of information is derived from the literature titled \'Large-scale Pan-cancer Cell Line Screening Identifies Actionable and Effective Drug Combinations (Pubmed ID: 38456804)\'.">' + value + '</span>';
            }
            }

            function Evi_Score_tooltipFormatter(value,row) {
if (value.includes('4')) {
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The evidence level of the data is LevelA, with an evidence level score of 4." ">' + value + '</span>';
} else if (value.includes('3')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The evidence level of the data is LevelB, with an evidence level score of 3.">' + value + '</span>';
}else if (value.includes('2')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The evidence level of the data is LevelC, with an evidence level score of 2.">' + value + '</span>';
}else if (value.includes('1')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The evidence level of the data is LevelD, with an evidence level score of 1.">' + value + '</span>';
}
}
        
function Act_Score_tooltipFormatter(value,row) {
  if (value.includes('3')) {
	return '<span style="cursor: pointer;" data-toggle="tooltip" title="The data annotates feasible mutations for the overall drug combination regimen, with an Biomarker matching Score of 3.">' + value + '</span>';
  } else if (value.includes('2')){
	return '<span style="cursor: pointer;" data-toggle="tooltip" title="The data annotates viable mutations specifically for individual drugs or a subset of drugs within the drug combination regimen, as opposed to the entire drug combination regimen. The biomarker matching Score is 2.">' + value + '</span>';
  }else if (value.includes('1')){
	return '<span style="cursor: pointer;" data-toggle="tooltip" title="The data exclusively provides information about drug combination regimens without annotating any feasible mutation details. Its biomarker matching Score is 1.">' + value + '</span>';
  }
  }

              function FDA_Score_tooltipFormatter(value,row) {
if (value.includes('3')) {
return '<span style="cursor: pointer;" data-toggle="tooltip" title="All drugs in the drug combination regimen are FDA-approved, with an FDA Evidence Score of 3.">' + value + '</span>';
} else if (value.includes('2')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="Some drugs within the drug combination regimen are FDA-approved, with an FDA Evidence Score of 2.">' + value + '</span>';
}else if (value.includes('1')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="None of the drugs within the drug combination regimen are FDA-approved, with an FDA Evidence Score of 1.">' + value + '</span>';
}
}

              
function Response_Score_tooltipFormatter(value,row) {
if (value.includes('-1')) {
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The outcome of the drug combination regimen is resistant response, with an Response Score of -1.">' + value + '</span>';
} else if (value.includes('1')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="The outcome of the drug combination regimen is sensitive response, with an Response Score of 1.">' + value + '</span>';
}
}
              

          function Prioritization_Score_tooltipFormatter(value,row) {
	var tooltipText = 
  'Evidence level score: ' + row.Evidence_level_score + ';\n' +
  'FDA evidence score: ' + row.FDA_evidence_score + ';\n' +
  'Response score: ' + row.Response_score+ ';\n' +
  'Biomarkers matching score: ' + row.Action_mutation_score + ';\n' +
  'Biomarkers precision score: ' + row.Actionable_mutation_precision_score
  return '<span style="cursor: pointer;" data-toggle="tooltip" title="' + tooltipText + '">' + value + '</span>';
  }
              
  function Actionable_Mutation_Precision_Score_tooltipFormatter(value,row) {
if (value.includes('3')) {
return '<span style="cursor: pointer;" data-toggle="tooltip" title="All annotated biomarkers in the data entry were at the single amino acid change level, the biomarker precision score is 3.">' + value + '</span>';
} else if (value.includes('2')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="Some biomarkers were at the single amino acid change level or some were at the gene level, the biomarker precision score is 2.">' + value + '</span>';
}else if (value.includes('1')){
return '<span style="cursor: pointer;" data-toggle="tooltip" title="All annotated biomarkers were at the gene level, the biomarker precision score is 1.">' + value + '</span>';
}
}

              
              function combinedFormatter(value,row){
                var formattedValue = '';

                if (value.includes('Nishanth Ulhas Nair et al. Cell Line')) {
                  formattedValue += '<image src="../static/img/lung2.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                } else if (value.includes('NCI treatment/NCCN guidelines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Ravi S. Narayan et al. Cell Lines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Patricia Jaaks et al. Cell Lines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Jennifer O"Neil et al. Cell Lines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('VICC')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('ClinicalTrials.gov')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('TMUSH')){
                  formattedValue +=  '<image src="../static/img/hospital.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('ALMANAC')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Patricia Jaaks et al. Cell Lines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('DCDB')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('DrugCombDB')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('I-PREDICT Clinical Trial')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Hui Gao et al. PDX')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('REFLECT')){
                  formattedValue +=  '<image src="../static/img/database.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }else if (value.includes('Azadeh C. Bashi et al. Cell Lines')){
                  formattedValue +=  '<image src="../static/img/book.svg" width="15" height="15">' ;
                  formattedValue += ComID_tooltipFormatter(value, row);
                }
                return formattedValue;
              }

              function EviID_tooltipFormatter(value) {
if (value.includes('Level A')) {
  return '<span  style="cursor: pointer;" data-toggle="tooltip" title="From professional guidelines or FDA-approved therapies." >' + value + '</span>';
}else if (value.includes('Level B')){
  return '<span style="cursor: pointer;" data-toggle="tooltip" title="From clinical trials, well-powered studies, and individual case reports from clinical journals or hospital cases.">' + value + '</span>';
}else if (value.includes('Level C')){
  return '<span style="cursor: pointer;" data-toggle="tooltip" title="From mouse studies, cell lines and molecular assays.">' + value + '</span>';
}else if (value.includes('Level D')){
  return '<span style="cursor: pointer;" data-toggle="tooltip" title="From computational prediction.">' + value + '</span>';
}
}

            function urlFormatter(value, row) {
            // 判断是否包含 HTTP
            if (value.includes('http')) {
              return '<a href="' + value + '" target="_blank">' + value + '</a>';
            } else {
              // 不包含 HTTP，直接返回原始值
              return value;
            }
          }
              
          function each_drug_linkFormatter(value) {
          const links = value.split("; ");
          let html = "";
          for (let i = 0; i < links.length; i++) {
            const link = links[i];
            // 判断链接是否为 "NA"
            if (link !== "nan") {
              const web_link = '/oncodrug/each_drug_info/';
              const href = web_link + link;
              html += `<a href="${href}" target="_blank">${link}</a>`;
            } else {
              // 链接为 "NA"，直接显示原始值
              html += link;
            }
            if (i !== links.length - 1) {
              html += "; ";
            }
          }
          return html;
        }

                function cancer_oncotree_linkFormatter(value) {
                const links = value.split(";");
                let html = "";
                for (let i = 0; i < links.length; i++) {
                  const link = links[i];
                  const web_link='/oncodrug/each_cancer_oncotree/'
                  const href = web_link+link ;
                  html += `<a href="${href}" target="_blank">${link}</a>`;
                  if (i !== links.length - 1) {
                    html += "; ";
                  }
                }
                return html;
                }


                function actmut_linkFormatter(value) {
                const links = value.split("; ");
                let html = "";
                for (let i = 0; i < links.length; i++) {
                  const link = links[i];
                  const web_link='/oncodrug/each_actmut_info/'
                  const href = web_link+link ;
                  html += `<a href="${href}" target="_blank">${link}</a>`;
                  if (i !== links.length - 1) {
                    html += "; ";
                  }
                }
                return html;
                }


              function operateFormatter(value, row, index) {
                return [
                  '<a class="like" href="javascript:void(0)" title="Like">',
                  '<i class="fa fa-heart"></i>',
                  '</a>  ',
                  '<a class="remove" href="javascript:void(0)" title="Remove">',
                  '<i class="fa fa-trash"></i>',
                  '</a>'
                ].join('')
              }
            
              
              window.operateEvents = {
                'click .like': function (e, value, row, index) {
                  alert('You click like action, row: ' + JSON.stringify(row))
                },
                'click .remove': function (e, value, row, index) {
                  $table.bootstrapTable('remove', {
                    field: 'id',
                    values: [row.id]
                  })
                }
              }
            
              function totalTextFormatter(data) {
                return 'Total'
              }
            
              function totalNameFormatter(data) {
                return data.length
              }
            
              function totalPriceFormatter(data) {
                var field = this.field
                return '$' + data.map(function (row) {
                  return +row[field].substring(1)
                }).reduce(function (sum, i) {
                  return sum + i
                }, 0)
              }
            
              function initTable() {
                $table.bootstrapTable('destroy').bootstrapTable({

                  locale: $('#locale').val(),
      
                })
                $table.on('check.bs.table uncheck.bs.table ' +
                  'check-all.bs.table uncheck-all.bs.table',
                function () {
                  $remove.prop('disabled', !$table.bootstrapTable('getSelections').length)
            
                  // save your data, here just save the current page
                  selections = getIdSelections()
                  // push or splice the selections if you want to save all data selections
                })
                $table.on('all.bs.table', function (e, name, args) {
                  console.log(name, args)
                })
                $remove.click(function () {
                  var ids = getIdSelections()
                  $table.bootstrapTable('remove', {
                    field: 'id',
                    values: ids
                  })
                  $remove.prop('disabled', true)
                })
              }
            
              $(function() {
                initTable()
            
                $('#locale').change(initTable)
              })
        </script>

        <!-- 引入 jQuery -->

          <div id='visualization_plot' class="card">
                            
              <div class="container">
              
                  <div class="row">
              <div class="col-md-6">
                <div id="main" style="width: 600px;height:600px; position: relative; left: 0px; top: 10px;"></div>
                </div>
              <div class="col-md-6" >
                <div id="drug_Chart" style="width: 600px;height:600px; position: relative; left: 50px; top: 10px;"></div>
            </div>
              
            <div class="row">
                <!-- 第二行第一列 -->
                <div class="col-md-6">
                    <div id="evidence_Chart" style="width: 600px;height:600px; position: relative; left: 0px; top: 10px;"></div>
                </div>
                <!-- 第二行第二列 -->
                <div class="col-md-6">
                    <div id="cancer_Chart" style="width: 600px;height:600px; position: relative; left: 50px; top: -15px;"></div>
                </div>
            </div>
              
            <script>
              var chart = document.getElementById("evidence_Chart");
              chart.style.top = "-18px";
              </script>

              </div>
              <script src="/oncodrug/static/js/package/dist/echarts.js"></script>
              <script src="/oncodrug/static/js/echarts-wordcloud.min.js"></script>
              <script src="/oncodrug/static/js/jquery.min.js"></script>
              <script type="text/javascript">

                  var chart_main = echarts.init(document.getElementById('main'));
                  var option_main = JSON.parse('{{ option_json|safe }}');
                  chart_main.setOption(option_main);
                  chart_main.on('click', function (params) {
                    if (params.dataType == 'node') {
                      var nodeName = params.data.name;
                       window.open('/oncodrug/each_actmut_info/'+nodeName)

                    }
                });

                 var drug_Chart = echarts.init(document.getElementById('drug_Chart'));
                  var option_drug = JSON.parse('{{ drug_option_json|safe }}');
                  drug_Chart.setOption(option_drug);
                  drug_Chart.on('click', function (params) {
                    if (params.data) {
                    var drug_nodeName = params.data.name;
                    if (drug_nodeName.includes(';')) {
                    window.open('/oncodrug/each_combdrug_info/' + drug_nodeName);
                    } else {
                        window.open('/oncodrug/each_drug_info/' + drug_nodeName);
                    }
                    }
                    });
                  
                   var evidence_Chart = echarts.init(document.getElementById('evidence_Chart'));
                  var option_evidence = JSON.parse('{{ evidence_option_json|safe }}');
                  evidence_Chart.setOption(option_evidence);
                  
                   var cancer_Chart = echarts.init(document.getElementById('cancer_Chart'));
                  var option_cancer = JSON.parse('{{ cancer_type_option_json|safe }}');
                  cancer_Chart.setOption(option_cancer);
                  cancer_Chart.on('click', function (params) {
                  if (params.data) {
                    var cancer_nodeName = params.data.name;
                      window.open('/oncodrug/each_cancer_oncotree/'+cancer_nodeName)

                  }
                 });
                  

                  
              </script>
          </div>
        
      </div>
</div>
</div>

<footer>
  <div class="row ">
    <div class="col-md-12 footer-content">
           <p class="pull-left"  style="margin-top: 20px;color: white;">2023-2024 © Mulinlab@Tianjin Medical University, All Rights Reserved.</p>
    </div>
  </div>
</footer> 


{% endblock %}

